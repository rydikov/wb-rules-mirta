# Проект с правилами Wirenboard для моего дома 

Ссылка на дом: https://t.me/rydikov_house

Правила написаны на Type Script, компилируются в Java Script ES5 и загружаются на контроллер для исполнения.

### У правил есть конвенция и стуктура:

Устройства описаны в виде классов, а в файле 'src/wb-rules-modules/global-devices.ts' задается соответствие с расположением устройства в доме.
Например: 

```js
Cabinet_01: new RelayLight('wb-mr6cv3_217/K6') 
```
означает что в комнате `Cabinet` группе освещения `01` соотвествуют `реле с выхдом 6`.
Все группы освещения описаны в плане освещения, который находится в docs.

Основное удобство в том, что для того чтобы включить лампочку вместо:

```js
dev['wb-mr6cv3_217/K6'] = true;
```

Нужно указывать:

```js
RelayLights.Cabinet_01.on()
```

А для того чтобы подписаться на изменение топика вместо:

```js
whenChanged: ['mtdx62-mb_7/presence_status']
```

Нужно указать:

```js
whenChanged: [PresenceSensors.hall.presence_status_topic]
```

Также в классы выносится дополнительная логика и проверки.

### Привила именуются с префиксами:

`alarms.ts` оповещение о анамальных поведения устройств, например, устройство стало offline и т.д. Актуально для сторонних zigbee устройств.

`check-*.ts` проверка доступности устройств опрашивая их статус или время прередачи данных. Актуально для сторонних устройств.

`run-*.ts` правила если что-то происходит от других контролов, нажали в выключатель, повысилась температура и т.д.

`sync-*.ts` синхронизация внешних устройс с виртуальными. Актуально для сторонних устройств.

### Сборка и деплой

Для сборки проекта нужно выполнить:

```
pnpm build
```

Для деплоя на контроллер:

```
pnpm wb:deploy
```

После повышения версии фреймворка mirta нужно сделать:
```
pnpm install
```

### Credits:

* [Mirta](https://github.com/wb-mirta/core)
* [Wb-Rules](https://github.com/wirenboard/wb-rules)


